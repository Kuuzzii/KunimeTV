<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Watch - KuNime</title>
  <link rel="stylesheet" href="watch.css" />
  <script defer src="watch.js"></script>
  <style>
    /* Reset and base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    body {
      background-color: #111;
      color: #fff;
      line-height: 1.5;
    }
    /* Navbar styling */
    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 20px;
      background-color: #000;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #e60000;
      font-weight: 700;
      font-size: 20px;
    }
    .logo img {
      height: 35px;
      border-radius: 4px;
    }
    .back-button {
      padding: 8px 16px;
      background-color: #e60000;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.2s;
    }
    .back-button:hover {
      background-color: #cc0000;
    }
    /* Movie container styling */
    .movie-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 15px;
    }
    /* Movie backdrop and details */
    .movie-backdrop {
      position: relative;
      padding: 25px 0;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 20px;
    }
    .movie-backdrop::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1;
    }
    .movie-details {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: row;
      gap: 25px;
      padding: 0 20px;
    }
    .movie-poster {
      flex-shrink: 0;
      width: 220px;
      height: 330px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }
    .movie-poster img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .movie-info {
      flex-grow: 1;
    }
    .movie-info h1 {
      font-size: 28px;
      margin-bottom: 10px;
      color: #fff;
    }
    .movie-meta {
      color: #ccc;
      margin-bottom: 15px;
    }
    .movie-genres {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 15px;
    }
    .movie-genres span {
      background-color: rgba(255, 255, 255, 0.1);
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 14px;
    }
    #movie-overview {
      color: #ddd;
      margin-bottom: 20px;
      line-height: 1.6;
    }
    .movie-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: flex-start;
    }
    .action-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
    }
    .play-btn {
      background-color: #e60000;
      color: white;
    }
    #server-select {
      background-color: #333;
      color: white;
      padding: 10px 15px;
    }
    /* Warning box styling */
    .warning-box {
      margin-top: 15px;
      padding: 12px 16px;
      background-color: #ff9800; /* Orange background */
      color: #000;
      font-weight: 600;
      font-size: 1rem;
      border-radius: 4px;
      user-select: none;
      max-width: 600px;
      box-sizing: border-box;
      width: 100%;
    }
    /* Video container styling */
    .video-container {
      position: relative;
      width: 100%;
      height: 0;
      padding-bottom: 56.25%; /* 16:9 aspect ratio */
      margin-bottom: 30px;
      background-color: #000;
      border-radius: 8px;
      overflow: hidden;
    }
    #movie-video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
    }
    /* Responsive adjustments */
    @media (max-width: 992px) {
      .movie-poster {
        width: 180px;
        height: 270px;
      }
      .movie-info h1 {
        font-size: 24px;
      }
    }
    @media (max-width: 768px) {
      .movie-details {
        flex-direction: column;
        align-items: center;
        text-align: center;
      }
      .movie-poster {
        width: 200px;
        height: 300px;
        margin-bottom: 20px;
      }
      .movie-genres {
        justify-content: center;
      }
      .movie-actions {
        flex-direction: column;
        align-items: center;
      }
      .action-btn, #server-select, .warning-box {
        width: 100%;
        max-width: 400px;
      }
      .navbar {
        padding: 10px 15px;
      }
      .logo {
        font-size: 18px;
      }
      .logo img {
        height: 30px;
      }
      .back-button {
        padding: 6px 12px;
        font-size: 14px;
      }
    }
    @media (max-width: 480px) {
      .movie-container {
        padding: 0 10px;
      }
      .movie-backdrop {
        padding: 15px 0;
      }
      .movie-poster {
        width: 160px;
        height: 240px;
      }
      .movie-info h1 {
        font-size: 20px;
      }
      #movie-overview {
        font-size: 14px;
      }
      .movie-meta, .movie-genres span {
        font-size: 13px;
      }
      .warning-box {
        font-size: 0.9rem;
        padding: 10px 12px;
      }
      .video-container {
        margin-bottom: 20px;
      }
    }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="logo">
      <img src="https://static.vecteezy.com/system/resources/previews/016/699/663/original/graffiti-letter-k-premium-illustration-vector.jpg" alt="KuNime Logo" />
      <span>KuNime</span>
    </div>
    <button id="back-btn" type="button" class="back-button">&#8592; Back to Homepage</button>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const backBtn = document.getElementById('back-btn');
        backBtn.addEventListener('click', () => {
          window.location.href = 'https://kunimetv.pages.dev/main';
        });
      });
    </script>
  </header>
  <main class="movie-container">
    <div id="movie-backdrop" class="movie-backdrop">
      <div class="movie-details">
        <div class="movie-poster">
          <img id="movie-poster" src="" alt="Movie Poster" />
        </div>
        <div class="movie-info">
          <h1 id="movie-title"></h1>
          <p class="movie-meta">
            <span id="movie-release-date"></span> •
            <span id="movie-runtime"></span>
          </p>
          <div id="movie-genres" class="movie-genres"></div>
          <p id="movie-overview"></p>
          <div class="movie-actions">
            <button id="play-btn" type="button" class="action-btn play-btn">&#9658; Play</button>
            <select id="server-select" class="action-btn" aria-label="Select Streaming Server" >
              <option value="vidsrc.cc">Vidsrc.cc</option>
              <option value="vidsrc.me" selected>Vidsrc.me</option>
              <option value="videasy.net">Videasy.net</option>
              <option value="getsuperembed.link">Getsuperembed.link</option>
            </select>
            <!-- Warning Box -->
            <div class="warning-box" role="alert" aria-live="polite">
              ⚠️Some servers may occasionally be unavailable. If the one you selected is not working, please try another. For the best experience, we recommend choosing one of the first four servers listed
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="video-container">
      <iframe id="movie-video" frameborder="0" allowfullscreen loading="lazy" title="Streaming Video Player"></iframe>
    </div>
  </main>

  <!-- Script to handle Play button and dynamic embed -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const playBtn = document.getElementById('play-btn');
      const iframe = document.getElementById('movie-video');
      const serverSelect = document.getElementById('server-select');

      // Helper to get query params
      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      // Get imdb id from URL query param e.g. ?imdb=tt0944947
      const imdbId = getQueryParam('imdb');

      if (!imdbId) {
        alert('Error: No IMDb ID provided in URL. Please add ?imdb=ttXXXXXXX');
        playBtn.disabled = true;
        return;
      }

      // Optionally: You can fetch movie details from TMDB or OMDB here using imdbId to populate UI
      // For demonstration, just display IMDb ID somewhere or leave blank

      playBtn.addEventListener('click', async () => {
        const server = serverSelect.value;

        playBtn.disabled = true;
        playBtn.textContent = 'Loading...';

        try {
          let embedUrl = '';

          if(server === 'vidsrc.me') {
            embedUrl = `https://vidsrc.me/embed/${imdbId}/`;
          } else if(server === 'vidsrc.cc') {
            embedUrl = `https://vidsrc.cc/embed/${imdbId}/`;
          } else if(server === 'videasy.net') {
            embedUrl = `https://videasy.net/embed/${imdbId}/`;
          } else if(server === 'getsuperembed.link') {
            // Fetch real player link from getsuperembed.link, which returns URL in plain text
            const apiUrl = `https://getsuperembed.link/?video_id=${imdbId}`;
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error('Failed to fetch embed URL from getsuperembed');
            embedUrl = (await response.text()).trim();
          } else {
            // Default fallback
            embedUrl = `https://vidsrc.me/embed/${imdbId}/`;
          }

          iframe.src = embedUrl;

        } catch (err) {
          alert('Error loading video: ' + err.message);
          console.error(err);
        }

        playBtn.disabled = false;
        playBtn.textContent = '▶ Play';
      });
    });
  </script>
</body>
</html>
